<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿè—¥å­¸æ•¸ä½è—¥å…¸ | æœ¬è‰å­¸åœ’</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
  <style>
    /* === 1. å…¨å±€è®Šæ•¸èˆ‡åŸºç¤è¨­å®š === */
    :root {
        /* å“ç‰Œè‰²èª¿ï¼šæ›´é£½å’Œã€æ›´ç¾ä»£ */
        --primary: #4A7C59;
        --primary-dark: #2C5E4F;
        --primary-light: #e8f5e9;
        --accent: #E8F5E9;
        --text-dark: #2d3436; /* åæ·±ç°ï¼Œæ¯”ç´”é»‘æŸ”å’Œ */
        --text-light: #636e72;
        --bg-color: #f0f2f5; /* ç¨å¾®æ·±ä¸€é»çš„ç°ç™½ï¼Œå‡¸é¡¯å¡ç‰‡ */
        
        /* ğŸ’¡ é«˜ç´šæ„Ÿé™°å½±ç³»çµ± (Layered Shadows) */
        --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
        --shadow-md: 0 8px 24px rgba(0,0,0,0.08);
        --shadow-lg: 0 16px 48px rgba(0,0,0,0.12);
        --shadow-hover: 0 20px 40px rgba(74, 124, 89, 0.15);
    }

    * { box-sizing: border-box; outline: none; }

    body {
        font-family: 'Noto Sans TC', system-ui, -apple-system, sans-serif;
        background-color: var(--bg-color);
        margin: 0;
        color: var(--text-dark);
        line-height: 1.6;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        -webkit-font-smoothing: antialiased; /* å­—é«”æ›´æ¸…æ™° */
    }

    /* è‡ªè¨‚æ²è»¸ (è®“æ•´é«”æ„Ÿæ›´ä¸€è‡´) */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

    /* === 2. å°è¦½åˆ— (ç»ç’ƒæ“¬æ…‹ + æ¨¡ç³Šå¢å¼·) === */
    nav {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px); /* æ›´å¼·çš„æ¨¡ç³Š */
        -webkit-backdrop-filter: blur(12px);
        padding: 0.8rem 2rem;
        box-shadow: var(--shadow-sm);
        display: flex; justify-content: space-between; align-items: center;
        position: sticky; top: 0; z-index: 100;
        transition: all 0.3s ease;
        border-bottom: 1px solid rgba(255,255,255,0.3);
    }
    .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary-dark); text-decoration: none; display: flex; align-items: center; gap: 10px; letter-spacing: 1px; }
    .nav-links a { 
        text-decoration: none; color: var(--text-light); margin-left: 25px; 
        font-weight: 500; transition: 0.3s; position: relative; padding: 5px 0;
    }
    .nav-links a:hover, .nav-links a.active { color: var(--primary); }
    .nav-links a::after {
        content: ''; position: absolute; width: 0; height: 2px; bottom: 0; left: 0;
        background: var(--primary); transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .nav-links a:hover::after { width: 100%; }

    /* === 3. æœå°‹èˆ‡ç¯©é¸å€ (Hero) === */
    .hero-section {
        background: linear-gradient(135deg, #4A7C59 0%, #1a4236 100%);
        padding: 4rem 1rem 6rem 1rem; /* åº•éƒ¨ç•™æ›´å¤šç™½ */
        text-align: center;
        color: white;
        margin-bottom: -50px; /* è®“å¡ç‰‡å¾€ä¸Šæµ®å‹•æ›´å¤š */
        border-radius: 0 0 40px 40px; /* æ›´åœ“æ½¤çš„åº•éƒ¨ */
        position: relative;
        overflow: hidden;
    }
    /* å¢åŠ ä¸€é»èƒŒæ™¯ç´‹ç† */
    .hero-section::before {
        content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background-image: radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px);
        background-size: 30px 30px; opacity: 0.3;
    }
    
    .hero-title { 
        font-size: 2.4rem; margin-bottom: 2rem; font-weight: 700; letter-spacing: 2px; 
        text-shadow: 0 4px 10px rgba(0,0,0,0.2); position: relative;
    }
    
    .search-container {
        max-width: 800px; margin: 0 auto; position: relative;
        background: rgba(255,255,255,0.95);
        border-radius: 16px; padding: 8px;
        display: flex; box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        backdrop-filter: blur(10px);
        transition: transform 0.3s;
    }
    .search-container:focus-within { transform: scale(1.02); box-shadow: 0 25px 50px rgba(0,0,0,0.25); }

    .search-box {
        width: 100%; padding: 12px 20px;
        border-radius: 12px; border: none; font-size: 1.1rem;
        background: transparent; color: #333;
    }
    
    .filter-tags {
        display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;
        margin-top: 30px; max-width: 1000px; margin-left: auto; margin-right: auto; position: relative;
    }
    .filter-tag {
        background: rgba(255,255,255,0.15); color: white;
        padding: 8px 20px; border-radius: 50px;
        cursor: pointer; transition: 0.3s;
        border: 1px solid rgba(255,255,255,0.2);
        font-size: 0.9rem; font-weight: 500;
    }
    .filter-tag:hover, .filter-tag.active {
        background: white; color: var(--primary-dark);
        transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    /* === 4. å¡ç‰‡ç¶²æ ¼å€ === */
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px 60px 20px; position: relative; z-index: 10; }
    
    /* æ¬¡ç´šç¯©é¸ (ä¸­åˆ†é¡) */
    #sub-filter-container { 
        display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 25px; 
        background: white; padding: 20px; border-radius: 16px; box-shadow: var(--shadow-sm);
        justify-content: center; border: 1px solid rgba(0,0,0,0.03);
    }
    .sub-tag {
        background: #f8f9fa; color: #666; padding: 6px 16px; border-radius: 8px;
        cursor: pointer; border: 1px solid transparent; font-size: 0.9rem; transition: 0.2s;
    }
    .sub-tag:hover, .sub-tag.active { 
        background: var(--primary-light); color: var(--primary-dark); 
        border-color: var(--primary); font-weight: bold; 
    }

    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
    }

    /* === 5. è—¥å­¸å¡ç‰‡ (æ•ˆèƒ½èˆ‡ç¾è§€æ ¸å¿ƒ) === */
    .card {
        background: white; border-radius: 20px; overflow: hidden;
        box-shadow: var(--shadow-sm); 
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* å½ˆæ€§å‹•ç•« */
        position: relative; cursor: pointer; border: 1px solid white;
        display: flex; flex-direction: column;
        
        /* â˜…â˜…â˜… è¨˜æ†¶é«”ç®¡ç†æ ¸å¿ƒ â˜…â˜…â˜… */
        /* ç€è¦½å™¨åªæœƒæ¸²æŸ“ç•«é¢ä¸­çš„å¡ç‰‡ï¼Œå¤§å¹…æå‡æ•¸ç™¾ç­†è³‡æ–™æ™‚çš„æµæš¢åº¦ */
        content-visibility: auto; 
        contain-intrinsic-size: 0 350px; 
    }
    .card:hover {
        transform: translateY(-10px) scale(1.01);
        box-shadow: var(--shadow-hover);
        border-color: var(--primary-light);
        z-index: 2;
    }
    /* è£é£¾æ¢æ”¹ç‚ºé ‚éƒ¨æ¼¸å±¤ */
    .card::before {
        content: ''; position: absolute; left: 0; top: 0; width: 100%; height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--primary-dark));
    }

    .card-body { padding: 25px; flex: 1; }
    
    .card-category {
        font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px;
        color: var(--primary); font-weight: 800; margin-bottom: 8px;
        background: var(--primary-light); display: inline-block; 
        padding: 4px 10px; border-radius: 6px;
    }
    
    .card-title { font-size: 1.5rem; font-weight: 700; color: var(--text-dark); margin: 5px 0 2px 0; line-height: 1.3; }
    .card-subtitle { font-size: 0.9rem; color: #888; font-family: 'Roboto Mono', monospace; margin-bottom: 20px; font-style: italic; }

    .info-row {
        display: flex; justify-content: space-between; font-size: 0.95rem; margin-top: 10px;
        color: var(--text-light); border-bottom: 1px dashed #eee; padding-bottom: 6px;
    }
    .info-label { font-weight: 600; color: #555; }

    .card-footer {
        padding: 15px 25px; background: #fff; 
        border-top: 1px solid #f0f0f0;
        text-align: right; font-size: 0.9rem; color: var(--primary); font-weight: bold;
        display: flex; justify-content: flex-end; align-items: center; gap: 5px;
    }
    .card-footer::after { content: 'â†’'; transition: transform 0.2s; }
    .card:hover .card-footer::after { transform: translateX(5px); }

    /* === 6. å½ˆçª—æ¨£å¼ (æ¥µè‡´ç¾åŒ–) === */
    .modal-overlay, .chem-modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(20, 30, 25, 0.7); /* æ·±ç¶ é»‘èƒŒæ™¯ */
        backdrop-filter: blur(8px);
        z-index: 1000; display: none; justify-content: center; align-items: center;
        padding: 20px;
    }
    .chem-modal-overlay { z-index: 2000; background: rgba(0,0,0,0.6); }
    
    .modal-content {
        background: white; width: 100%; max-width: 900px; max-height: 90vh;
        border-radius: 24px; overflow-y: auto; position: relative;
        box-shadow: var(--shadow-lg);
        animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .chem-modal-box {
        background: white; width: 100%; max-width: 380px;
        padding: 30px; border-radius: 20px; text-align: center;
        box-shadow: var(--shadow-lg);
        animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes slideUp { from { opacity: 0; transform: translateY(40px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
    @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

    .modal-header {
        background: var(--primary); color: white; padding: 20px 30px;
        position: sticky; top: 0; z-index: 10;
        display: flex; justify-content: space-between; align-items: center;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .modal-title-group h2 { margin: 0; font-size: 1.8rem; letter-spacing: 1px; }
    .close-btn { background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
    .close-btn:hover { background: white; color: var(--primary); transform: rotate(90deg); }

    .modal-body { padding: 40px; color: #333; }

    /* è©³æƒ…å…§æ–‡æ’ç‰ˆ */
    .section-title {
        font-size: 1.3rem; font-weight: 800; color: var(--primary-dark);
        border-left: 5px solid var(--primary); padding-left: 15px; margin: 30px 0 20px;
        background: linear-gradient(90deg, var(--primary-light), transparent);
        padding: 8px 15px; border-radius: 0 8px 8px 0;
    }
    .section-title:first-child { margin-top: 0; }

    .tag-cloud { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
    .tag { background: #f1f3f5; color: #495057; padding: 6px 14px; border-radius: 50px; font-size: 0.9rem; font-weight: 500; }

    /* æˆåˆ†ç¶²æ ¼ (æ”¹é€²ç‰ˆ) */
    .chem-grid { 
        display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; 
    }
    .chem-item { 
        text-align: center; border: 1px solid #eee; padding: 20px 10px; border-radius: 16px;
        transition: 0.3s; background: #fff; cursor: zoom-in; position: relative; overflow: hidden;
    }
    .chem-item:hover { border-color: var(--primary); box-shadow: var(--shadow-md); transform: translateY(-5px); }
    .chem-item img { max-width: 100%; max-height: 100px; object-fit: contain; margin-bottom: 10px; }
    .chem-name { font-size: 1rem; font-weight: bold; color: #444; }

    /* æ¯”è¼ƒè¡¨æ ¼ */
    .compare-table { width: 100%; border-collapse: separate; border-spacing: 0; border-radius: 12px; overflow: hidden; border: 1px solid #eee; }
    .compare-table th, .compare-table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
    .compare-table th { background: var(--primary-light); color: var(--primary-dark); font-weight: 800; width: 30%; border-right: 1px solid #eee; }
    .compare-table tr:last-child td, .compare-table tr:last-child th { border-bottom: none; }

    /* Rich Text å„ªåŒ– */
    .rich-content { text-align: left; color: #333 !important; font-size: 1.1rem; line-height: 1.8; letter-spacing: 0.5px; }
    .rich-content strong { color: var(--primary-dark); }
    .rich-content ul { margin-left: 20px; padding-left: 0; }
    .rich-content li { margin-bottom: 8px; }
    
/* === 7. æ‰‹æ©Ÿç‰ˆ RWD å„ªåŒ– (ç”Ÿè—¥å‰å°ä¿®æ­£ç‰ˆ) === */
    @media (max-width: 768px) {
        /* 1. å°è¦½åˆ—èª¿æ•´ (è·Ÿä¸­è—¥å‰å°ä¸€æ¨£ï¼šLogo ç½®ä¸­ï¼ŒæŒ‰éˆ•åœ¨ä¸‹æ’é–‹) */
        nav { 
            padding: 10px 15px; 
            flex-wrap: wrap; /* å…è¨±æ›è¡Œ */
        }
        
        .logo { 
            width: 100%; 
            justify-content: center; /* Logo ç½®ä¸­ */
            margin-bottom: 10px; 
        }
        
        /* å¦‚æœæ‚¨çš„ HTML çµæ§‹æœ‰åŒ…ä¸€å±¤ div class="nav-links" */
        .nav-links { 
            width: 100%; 
            display: flex; 
            justify-content: space-around; /* æŒ‰éˆ•å¹³å‡åˆ†æ•£ */
            padding-top: 10px; 
            border-top: 1px solid rgba(0,0,0,0.05); /* åŠ ä¸€æ¢æ·¡æ·¡çš„åˆ†éš”ç·š */
            margin-left: 0; /* ä¿®æ­£å¯èƒ½è¢«é›»è…¦ç‰ˆå½±éŸ¿çš„é‚Šè· */
        }
        
        /* å¦‚æœæ‚¨çš„ HTML çµæ§‹æ˜¯ç›´æ¥æ”¾ a æ¨™ç±¤åœ¨ nav è£¡ (æ²’æœ‰ nav-links)ï¼Œè«‹æ”¹ç”¨é€™å€‹ï¼š */
        /* nav a:not(.logo) {
            margin: 5px 10px;
            font-size: 0.9rem;
        }
        */

        .nav-links a { 
            margin: 0; 
            font-size: 0.9rem; 
        }

        /* 2. æ¨™é¡Œèˆ‡æœå°‹æ¡†èª¿æ•´ */
        .hero-title { font-size: 1.6rem; }
        
        /* 3. ç¯©é¸æ¨™ç±¤ (å¯æ©«å‘æ»‘å‹•) */
        .filter-tags { 
            justify-content: flex-start; 
            overflow-x: auto; 
            padding-bottom: 15px; 
            white-space: nowrap; 
            -webkit-overflow-scrolling: touch; 
        }
        
        /* 4. æ ¼ç·šèª¿æ•´ (ç¶­æŒå–®æ¬„æˆ–é›™æ¬„ï¼Œçœ‹æ‚¨æ±ºå®šï¼Œé€™è£¡é è¨­å–®æ¬„æ¯”è¼ƒé©åˆç”Ÿè—¥çµæ§‹åœ–) */
        .container { padding: 10px; margin-top: 10px; }
        .grid { grid-template-columns: 1fr; gap: 15px; } 

        /* å¡ç‰‡å…§è· */
        .card-body { padding: 20px; }
        
        /* å½ˆçª—æ»¿ç‰ˆ */
        .modal-content { max-height: 85vh; width: 95%; }
        .chem-modal-box { width: 90%; }
    }
</style>
</head>
<body>

    <nav>
        <a href="index.html" class="logo">ğŸŒ¿ æœ¬è‰å­¸åœ’</a>
        <div class="nav-links">
            <a href="index.html">ä¸­è—¥åº«</a>
            <a href="pharmacognosy.html">ç”Ÿè—¥åº«</a>
            <a href="quiz.html">è‡ªæˆ‘æ¸¬é©—</a>
            <a href="admin_menu.html">å¾Œå°ç®¡ç†</a>
        </div>
    </nav>

    <div class="hero-section">
        <h1 class="hero-title">ç”Ÿè—¥å­¸æ•¸ä½è—¥å…¸</h1>
        <div class="search-container">
            <input type="text" id="search-input" class="search-box" placeholder="ğŸ” æœå°‹ç”Ÿè—¥åç¨±ã€å­¸åã€é—œéµæˆåˆ†..." oninput="filterData()">
        </div>
        <div id="filter-container" class="filter-tags">
        <div class="filter-tag active" onclick="resetFilter(this)">å…¨éƒ¨</div>
    </div>

    <div id="sub-filter-container" class="filter-tags" style="margin-top:10px; min-height:10px;"></div>

    <div style="text-align:center; margin: 15px 0; height: 40px;">
        <button id="btn-cat-info" onclick="openCategoryModal()" style="display:none; background: linear-gradient(135deg, #4A7C59, #2C5E4F); color:white; border:none; padding:10px 25px; border-radius:30px; cursor:pointer; font-weight:bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition:0.3s; align-items:center; gap:8px;">
            ğŸ“– æŸ¥çœ‹ã€Œ<span id="current-cat-name"></span>ã€è©³ç´°ä»‹ç´¹
        </button>
    </div>

    <div id="cat-modal" class="modal-overlay" onclick="closeCategoryModal(event)">
        <div class="modal-content" style="max-width:800px;">
            <div class="modal-header">
                <h2 id="cat-modal-title" style="margin:0;">åˆ†é¡ä»‹ç´¹</h2>
                <button onclick="document.getElementById('cat-modal').style.display='none'" style="background:none; border:none; color:white; font-size:2rem; cursor:pointer;">Ã—</button>
            </div>
            <div class="modal-body rich-content" id="cat-modal-body" style="line-height:1.8; font-size:1.05rem;">
                è¼‰å…¥ä¸­...
            </div>
        </div>
    </div>

    <div class="container">
        <div id="loading" style="text-align:center; padding:50px; color:#888;">
            <h2>â³ æ­£åœ¨è¼‰å…¥ç”Ÿè—¥è³‡æ–™åº«...</h2>
        </div>
        
        <div id="pharma-grid" class="grid"></div>
    </div>

    <div id="detail-modal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-group">
                    <h2 id="modal-title">éº»é»ƒ</h2>
                    <span id="modal-subtitle">Ephedra</span>
                </div>
                <button class="close-btn" onclick="closeModalDirect()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="tag-cloud" id="modal-tags"></div>
                
                <div class="detail-section">
                    <div class="section-title">ğŸ“Œ åŸºæœ¬è³‡è¨Š</div>
                    <table class="compare-table">
                        <tr><th>åŸºåŸ (Origin)</th><td id="modal-origin"></td></tr>
                        <tr><th>ç§‘åˆ¥ (Family)</th><td id="modal-family"></td></tr>
                        <tr><th>ä½¿ç”¨éƒ¨ä½ (Part)</th><td id="modal-part"></td></tr>
                    </table>
                </div>

                <div class="detail-section">
                    <div class="section-title">âš—ï¸ åŒ–å­¸æˆåˆ† (Components)</div>
                    <div id="modal-chem-grid" class="chem-grid"></div>
                </div>

                <div class="detail-section">
                    <div class="section-title">ğŸ’¡ ç‰¹æ€§èˆ‡åŠŸæ•ˆ</div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                        <div>
                            <strong>æ€§ç‹€/ç‰¹æ€§ï¼š</strong>
                            <p id="modal-char" style="color:#555;"></p>
                        </div>
                        <div>
                            <strong>åŠŸæ•ˆï¼š</strong>
                            <p id="modal-efficacy" style="color:#555;"></p>
                        </div>
                    </div>
                </div>

                <div class="detail-section" style="background:#fff3e0; padding:15px; border-radius:10px;">
                    <strong>ğŸ’Š æ²»ç™‚/é©æ‡‰ç—‡ï¼š</strong> <span id="modal-treat"></span><br><br>
                    <strong>ğŸ§  è¨˜æ³•/å£è¨£ï¼š</strong> <span id="modal-mnemonic" style="color:#d32f2f; font-weight:bold;"></span>
                </div>

                <div class="detail-section" id="compare-section">
                    <div class="section-title">âš–ï¸ æ˜“æ··æ·†æ¯”è¼ƒ</div>
                    <table class="compare-table">
                        <thead><tr><th>æ¯”è¼ƒå°è±¡</th><th>å·®ç•°é»</th></tr></thead>
                        <tbody id="modal-compare-body"></tbody>
                    </table>
                </div>

                <div class="detail-section">
                    <div class="section-title">ğŸ“ è©³ç´°ç­†è¨˜</div>
                    <div id="modal-note" class="rich-content"></div>
                </div>
            </div>
        </div>
    </div>
<div id="chem-detail-modal" class="chem-modal-overlay" onclick="closeChemModal()">
        <div class="chem-modal-box" onclick="event.stopPropagation()">
            <div style="text-align:right;">
                <button onclick="closeChemModal()" style="background:none; border:none; font-size:1.5rem; cursor:pointer; color:#999;">Ã—</button>
            </div>
            
            <h3 id="chem-popup-name" style="margin-top:0; color:#4A7C59;">æˆåˆ†åç¨±</h3>
            
            <div style="background:#f9f9f9; padding:10px; border-radius:10px; margin-bottom:15px;">
                <img id="chem-popup-img" src="" style="max-width:100%; max-height:250px; object-fit:contain;">
            </div>

            <div id="chem-popup-note-box" style="display:none; background:#fff3e0; padding:15px; border-radius:10px; text-align:left; border-left:5px solid #ff9800;">
                <strong style="color:#e65100;">ğŸ“ å‚™è¨»ï¼š</strong>
               <div id="chem-popup-note" class="rich-content" style="color:#333; margin-top:5px; font-size:0.95rem;"></div>
            </div>
        </div>
    </div>

</div>
    <footer style="background: #333; color: #ccc; padding: 40px 20px; text-align: center; font-size: 0.9rem; margin-top: 50px;">
        <div style="max-width: 800px; margin: 0 auto; line-height: 1.8;">
            
            <div style="font-weight: bold; font-size: 1.1rem; color: #fff; margin-bottom: 15px;">
                <span id="footer-year"></span> Â© æœ¬è‰å­¸åœ’ (Pharma Garden)
            </div>

            <p style="margin-bottom: 20px;">
                æœ¬ç¶²ç«™å…§å®¹ç”±å­¸ç”Ÿç·´ç¿’è£½ä½œï¼Œ<br>
                <strong>åƒ…ä¾›å­¸è¡“äº¤æµã€åœ‹è€ƒè¤‡ç¿’èˆ‡æ•™è‚²ç”¨é€”ä½¿ç”¨</strong>ã€‚
            </p>

            <hr style="border: 0; border-top: 1px solid #555; margin: 20px 0;">

            <div style="text-align: left; font-size: 0.85rem; color: #aaa;">
                <p style="color: #ddd; margin-bottom: 8px;"><strong>âš ï¸ å…è²¬èˆ‡è‘—ä½œæ¬Šè²æ˜ï¼š</strong></p>
                <ul style="padding-left: 20px; margin: 0;">
                    <li><strong>è³‡æ–™ä¾†æºï¼š</strong>å…§å®¹å½™æ•´è‡ªè—¥å­¸æ•™ç§‘æ›¸ã€å­¸è¡“è¬›ç¾©åŠç¶²è·¯å…¬é–‹è³‡è¨Šï¼Œè‘—ä½œæ¬Šæ­¸åŸä½œè€…æ‰€æœ‰ã€‚</li>
                    <li><strong>åœ–ç‰‡ä¾†æºï¼š</strong>åŒ–å­¸çµæ§‹åœ–èˆ‡æ¤ç‰©åœ–ç‰‡å¼•ç”¨è‡ª <strong>Wikimedia Commons</strong> åŠå…¬æœ‰é ˜åŸŸè³‡æºï¼Œåƒ…ä½œæ•™å­¸ç¤ºæ„ã€‚</li>
                    <li><strong>éé†«ç™‚å»ºè­°ï¼š</strong>æœ¬ç«™è³‡è¨Šåƒ…ä¾›å­¸ç¿’åƒè€ƒï¼Œä¸æ§‹æˆé†«ç™‚å»ºè­°æˆ–è¨ºæ–·ï¼Œç”¨è—¥å•é¡Œè«‹è«®è©¢å°ˆæ¥­é†«å¸«è—¥å¸«ã€‚</li>
                </ul>
            </div>

            <div style="margin-top: 30px; font-size: 0.8rem; color: #666;">
                Designed with â¤ï¸ by Pharmacy Student Lucas
            </div>
        </div>
    </footer>

    <script>
        document.getElementById('footer-year').innerText = new Date().getFullYear();
    </script>
    <script src="pharma_config.js"></script>
<script>
    // === å…¨åŸŸè®Šæ•¸ ===
    let allData = [];
    let categoryData = {}; 
    let currentMainCat = 'all'; // ç›®å‰é¸çš„å¤§åˆ†é¡
    let currentSubCat = '';     // ç›®å‰é¸çš„ä¸­åˆ†é¡

    // === 1. åˆå§‹åŒ–èˆ‡è³‡æ–™è¼‰å…¥ ===
    document.addEventListener('DOMContentLoaded', () => {
         // æ›´æ–°é å°¾å¹´ä»½
            document.getElementById('footer-year').innerText = new Date().getFullYear();
        initFilters();
        
        // ä½¿ç”¨ Promise.all åŒæ™‚è¼‰å…¥å…©ä»½è³‡æ–™
        Promise.all([
            // A. è¼‰å…¥ç”Ÿè—¥åˆ—è¡¨ (â˜… åŠ å…¥æ™‚é–“æˆ³è¨˜ï¼Œé¿å…å¿«å–)
            fetch('data/pharma.json?t=' + Date.now()).then(r => r.ok ? r.json() : []).then(json => {
                if (json.content && json.encoding === 'base64') {
                    return JSON.parse(decodeURIComponent(escape(window.atob(json.content))));
                }
                return json;
            }),
            // B. è¼‰å…¥åˆ†é¡ä»‹ç´¹ (â˜… åŠ å…¥æ™‚é–“æˆ³è¨˜ï¼Œè§£æ±ºå¾Œå°æ›´æ–°å‰å°çœ‹ä¸åˆ°çš„å•é¡Œ)
            fetch('data/categories.json?t=' + Date.now()).then(r => r.ok ? r.json() : {}).then(json => {
                if (json.content && json.encoding === 'base64') {
                    return JSON.parse(decodeURIComponent(escape(window.atob(json.content))));
                }
                return json;
            }).catch(() => ({})) 
        ]).then(([pharmaList, catInfo]) => {
            // è³‡æ–™è¼‰å…¥å®Œæˆ
            allData = pharmaList || [];
            categoryData = catInfo || {};
            
            document.getElementById('loading').style.display = 'none';
            renderGrid(allData);

            // C. æª¢æŸ¥ç¶²å€åƒæ•¸ (ä¸­è—¥åº«è·³è½‰é‚è¼¯)
            const urlParams = new URLSearchParams(window.location.search);
            const query = urlParams.get('q');
            
            if (query) {
                const input = document.getElementById('search-input');
                input.value = query;
                filterData(); // åŸ·è¡Œæœå°‹

                // å¦‚æœç²¾ç¢ºåŒ¹é…åˆ°åªæœ‰ä¸€ç­†ï¼Œè‡ªå‹•é»é–‹è©³æƒ…
                const filtered = allData.filter(item => 
                    (item.name_en||"").toLowerCase().includes(query.toLowerCase()) || 
                    (item.components||[]).some(c => c.name.toLowerCase().includes(query.toLowerCase()))
                );
                
                if(filtered.length === 1) {
                    openDetail(filtered[0]);
                }
            }
        }).catch(err => {
            console.error("è³‡æ–™è¼‰å…¥éŒ¯èª¤:", err);
            document.getElementById('loading').innerHTML = "<p>è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ GitHub è¨­å®šã€‚</p>";
        });
    });

    // === 2. åˆ†é¡ç¯©é¸é‚è¼¯ (é›™å±¤é¸å–®æ ¸å¿ƒ) ===

    // åˆå§‹åŒ–ï¼šåªç”¢ç”Ÿå¤§åˆ†é¡æŒ‰éˆ•
   function initFilters() {
        const container = document.getElementById('filter-container');
        // æ¸…ç©ºä¸¦åŠ å…¥"å…¨éƒ¨"
        container.innerHTML = '<div class="filter-tag active" onclick="resetFilter(this)">å…¨éƒ¨ (All)</div>';
        
        if (typeof PHARMA_CATEGORIES !== 'undefined') {
            PHARMA_CATEGORIES.forEach(cat => {
                const tag = document.createElement('div');
                tag.className = 'filter-tag';
                
                // â˜… ä¿®æ”¹é»ï¼šé¡¯ç¤º "ä¸­æ–‡ (è‹±æ–‡)"
                tag.innerText = `${cat.name_ch} (${cat.name_en})`; 
                
                // é»æ“Šæ™‚å‚³å…¥åŸæœ¬çš„ä¸­æ–‡ key å³å¯
                tag.onclick = () => selectMainCategory(cat.name_ch, tag);
                container.appendChild(tag);
            });
        }
    }

    // é»æ“Šã€Œå…¨éƒ¨ã€
    function resetFilter(el) {
        currentMainCat = 'all';
        currentSubCat = '';
        updateActiveTag(el, 'filter-tag');
        document.getElementById('sub-filter-container').innerHTML = ""; // æ¸…ç©ºå­åˆ†é¡
        checkIntroButton();
        filterData();
    }

    // é»æ“Šã€Œå¤§åˆ†é¡ã€
    function selectMainCategory(mainCatName, el) {
        currentMainCat = mainCatName;
        currentSubCat = ''; // é‡ç½®å­åˆ†é¡
        updateActiveTag(el, 'filter-tag');

        // ç”¢ç”Ÿå­åˆ†é¡æŒ‰éˆ•
        renderSubCategories(mainCatName);
        
        checkIntroButton(); // æª¢æŸ¥æ˜¯å¦æœ‰ä»‹ç´¹æ–‡
        filterData();
    }

    // ç”¢ç”Ÿå­åˆ†é¡æŒ‰éˆ• UI
   function renderSubCategories(mainName) {
        const container = document.getElementById('sub-filter-container');
        container.innerHTML = ""; 

        // å¾ config æ‰¾è©²åˆ†é¡çš„å­åˆ†é¡
        const catConfig = PHARMA_CATEGORIES.find(c => c.name_ch === mainName);
        
        if (catConfig && catConfig.subcategories) {
            catConfig.subcategories.forEach(sub => {
                const btn = document.createElement('div');
                btn.className = 'sub-tag';
                
                // â˜… ä¿®æ”¹é»ï¼šé¡¯ç¤º "ä¸­æ–‡ (è‹±æ–‡)"
                btn.innerText = `${sub.ch} (${sub.en})`; 
                
                // é»æ“Šæ™‚å‚³å…¥åŸæœ¬çš„ä¸­æ–‡ key
                btn.onclick = () => selectSubCategory(sub.ch, btn);
                container.appendChild(btn);
            });
        }
    }

    // é»æ“Šã€Œä¸­åˆ†é¡ã€
    function selectSubCategory(subName, el) {
        currentSubCat = subName;
        updateActiveTag(el, 'sub-tag');
        
        checkIntroButton(); 
        filterData();
    }

    // æª¢æŸ¥ä¸¦é¡¯ç¤ºã€ŒğŸ“– æŸ¥çœ‹ä»‹ç´¹ã€æŒ‰éˆ• (â˜… é€™è£¡ä¿®å¾©äº†æŒ‰éˆ•äº‚è·‘çš„å•é¡Œ)
// === âœ… æ”¹è‰¯ç‰ˆï¼šæª¢æŸ¥ä¸¦é¡¯ç¤ºä»‹ç´¹æŒ‰éˆ• ===
    function checkIntroButton() {
        const btnInfo = document.getElementById('btn-cat-info');
        const spanName = document.getElementById('current-cat-name');
        
        // 1. æ±ºå®šç›®æ¨™ (å„ªå…ˆçœ‹ä¸­åˆ†é¡ï¼Œæ²’æœ‰å‰‡çœ‹å¤§åˆ†é¡)
        // ä¾‹å¦‚ï¼šé¸äº† "é…ç³–é«”"ï¼ŒtargetKey å°±æ˜¯ "é…ç³–é«”"
        let targetKey = currentSubCat ? currentSubCat : (currentMainCat !== 'all' ? currentMainCat : '');
        
        console.log(`ğŸ” æª¢æŸ¥åˆ†é¡ä»‹ç´¹: ç›®æ¨™=${targetKey}, ç›®å‰è³‡æ–™åº«ç­†æ•¸=${Object.keys(categoryData).length}`);

        // 2. å¦‚æœæ²’ç›®æ¨™ï¼Œæˆ–æ˜¯è³‡æ–™åº«é‚„æ²’è¼‰å…¥ï¼Œå°±éš±è—
        if (!targetKey || Object.keys(categoryData).length === 0) {
            btnInfo.style.display = 'none';
            return;
        }

        // 3. æ¯”å°è³‡æ–™åº« (æ¨¡ç³Šæ¯”å°ï¼Œåªè¦ Key åŒ…å«ç›®æ¨™æ–‡å­—å°±ç®—æ‰¾åˆ°)
        // ä¾‹å¦‚ï¼šè³‡æ–™åº«å­˜ "é…ç³–é«”"ï¼Œç›®æ¨™ "é…ç³–é«”" -> æˆåŠŸ
        // ä¾‹å¦‚ï¼šè³‡æ–™åº«å­˜ "é…ç³–é«” (Glycoside)"ï¼Œç›®æ¨™ "é…ç³–é«”" -> æˆåŠŸ
        const matchKey = Object.keys(categoryData).find(k => k.includes(targetKey));

        if (matchKey && categoryData[matchKey]) {
            console.log("âœ… æ‰¾åˆ°ä»‹ç´¹è³‡æ–™:", matchKey);
            // æ‰¾åˆ°äº†ï¼é¡¯ç¤ºæŒ‰éˆ•
            spanName.innerText = matchKey; 
            btnInfo.style.display = 'inline-flex';
            
            // â˜… é—œéµï¼šæŠŠæ‰¾åˆ°çš„ Key å­˜åˆ°æŒ‰éˆ•å±¬æ€§ä¸Š
            btnInfo.setAttribute('data-real-key', matchKey); 
        } else {
            console.log("âŒ æ‰¾ä¸åˆ°æ­¤åˆ†é¡çš„ä»‹ç´¹è³‡æ–™");
            btnInfo.style.display = 'none';
        }
    }

    // === âœ… æ”¹è‰¯ç‰ˆï¼šæ‰“é–‹åˆ†é¡ä»‹ç´¹è¦–çª— ===
    function openCategoryModal() {
        const btn = document.getElementById('btn-cat-info');
        
        // 1. å¾æŒ‰éˆ•å±¬æ€§è®€å– Key (æ”¹ç”¨ getAttribute æœ€ä¿éšª)
        const realKey = btn.getAttribute('data-real-key');
        
        if (!realKey) {
            alert("âŒ ç¨‹å¼éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°åˆ†é¡ Key");
            return;
        }
        
        // 2. å¡«å…¥æ¨™é¡Œèˆ‡å…§å®¹
        document.getElementById('cat-modal-title').innerText = `${realKey} - è©³ç´°ä»‹ç´¹`;
        
        const content = categoryData[realKey] || "<p>æš«ç„¡ä»‹ç´¹è³‡æ–™</p>";
        document.getElementById('cat-modal-body').innerHTML = content;
        
        // 3. é¡¯ç¤ºè¦–çª—
        document.getElementById('cat-modal').style.display = 'flex';
        
        // 4. é»æ“Šé®ç½©é—œé–‰ (é˜²æ­¢ onclick è¡çª)
        document.getElementById('cat-modal').onclick = function(e) {
            if (e.target === this) this.style.display = 'none';
        }
    }}
    // === 3. åŸ·è¡Œç¯©é¸èˆ‡æ¸²æŸ“ (è¶…ç´šæœå°‹ç‰ˆ) ===
    function filterData() {
        // å–å¾—ä½¿ç”¨è€…è¼¸å…¥çš„é—œéµå­—ï¼Œä¸¦è½‰å°å¯« (ç‚ºäº†ä¸åˆ†å¤§å°å¯«)
        const term = document.getElementById('search-input').value.toLowerCase().trim();
        
        const filtered = allData.filter(item => {
            // === A. æ™ºæ…§æœå°‹é‚è¼¯ (åªè¦ç¬¦åˆå…¶ä¸­ä¸€é …å°±ç®—æ•¸) ===
            const matchText = 
                // 1. ä¸­æ–‡å
                (item.name_ch || "").includes(term) || 
                // 2. è‹±æ–‡å (è½‰å°å¯«æ¯”å°)
                (item.name_en || "").toLowerCase().includes(term) ||
                // 3. åŸºåŸ/å­¸å
                (item.origin || "").toLowerCase().includes(term) ||
                // 4. â˜… æˆåˆ† (æƒæé™£åˆ—ä¸­çš„æ¯ä¸€å€‹æˆåˆ†å)
                (item.components || []).some(c => c.name.toLowerCase().includes(term)) ||
                // 5. â˜… [æ–°å¢] ç§‘å (ä¸­æ–‡æˆ–è‹±æ–‡)
                (item.family_ch || "").includes(term) ||
                (item.family_en || "").toLowerCase().includes(term) ||
                // 6. â˜… [æ–°å¢] åŠŸæ•ˆ/é©æ‡‰ç—‡ (ä¾‹å¦‚æœ "æ­¢ç—›")
                (item.efficacy || "").includes(term) ||
                // 7. â˜… [æ–°å¢] åˆ¥å (æƒæåˆ¥åé™£åˆ—)
                (item.aliases || []).some(a => a.includes(term));
            
            // === B. åˆ†é¡ç¯©é¸é‚è¼¯ (ä¸è®Š) ===
            let matchCat = true;
            if (currentMainCat !== 'all') {
                matchCat = (item.category_main || "").includes(currentMainCat);
                if (currentSubCat) {
                    matchCat = matchCat && (item.category_sub || "").includes(currentSubCat);
                }
            }

            // å…©å€‹æ¢ä»¶éƒ½è¦ç¬¦åˆ (æ–‡å­—æœ‰å°åˆ° AND åˆ†é¡æœ‰å°åˆ°)
            return matchText && matchCat;
        });

        renderGrid(filtered);
    }
    // 3. æ¸²æŸ“å¡ç‰‡ç¶²æ ¼ (å·²ä¿®æ”¹ï¼šç›´æ¥é¡¯ç¤ºæˆåˆ†åç¨±)
    function renderGrid(data) {
        const grid = document.getElementById('pharma-grid');
        grid.innerHTML = "";

        if (data.length === 0) {
            grid.innerHTML = "<p style='text-align:center; width:100%; grid-column:1/-1;'>æ‰¾ä¸åˆ°ç›¸é—œè—¥æ</p>";
            return;
        }

        data.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.onclick = () => openDetail(item);
            
            const family = item.family_ch || item.family_en || "æœªåˆ†é¡";
            const part = item.part_ch || "-";

            // â˜… ä¿®æ”¹é‡é»ï¼šè™•ç†æˆåˆ†åç¨±
            let compText = "ç„¡";
            if (item.components && item.components.length > 0) {
                // æŠŠæ‰€æœ‰æˆåˆ†çš„åå­—æŠ“å‡ºä¾†ï¼Œç”¨é “è™Ÿä¸²æ¥
                // ä¾‹å¦‚ï¼š "Morphineã€Codeineã€Thebaine"
                compText = item.components.map(c => c.name).join('ã€');
            }

            card.innerHTML = `
                <div class="card-body">
                    <div class="card-category">${item.category_main} / ${item.category_sub || ""}</div>
                    <h3 class="card-title">${item.name_ch}</h3>
                    <div class="card-subtitle">${item.name_en}</div>
                    
                    <div class="info-row">
                        <span class="info-label">ç§‘åˆ¥</span> <span>${family}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">éƒ¨ä½</span> <span>${part}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">æˆåˆ†</span> 
                        <span style="display:inline-block; max-width:180px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; vertical-align:bottom;" title="${compText}">
                            ${compText}
                        </span>
                    </div>
                </div>
                <div class="card-footer">æŸ¥çœ‹è©³æƒ… â”</div>
            `;
            grid.appendChild(card);
        });
    }
    // === 4. ç”Ÿè—¥è©³æƒ… Modal ===
    function openDetail(item) {
        const modal = document.getElementById('detail-modal');
        
        document.getElementById('modal-title').innerText = item.name_ch;
        document.getElementById('modal-subtitle').innerText = item.name_en;
        document.getElementById('modal-origin').innerText = item.origin || "-";
        document.getElementById('modal-family').innerText = `${item.family_ch || ""} (${item.family_en || ""})`;
        document.getElementById('modal-part').innerText = `${item.part_ch || ""} (${item.part_en || ""})`;

        // æ¨™ç±¤é›²
        const tagContainer = document.getElementById('modal-tags');
        tagContainer.innerHTML = "";
        [item.category_main, ...(item.aliases || [])].forEach(tagText => {
            if(tagText) {
                const tag = document.createElement('span');
                tag.className = 'tag'; tag.innerText = tagText;
                tagContainer.appendChild(tag);
            }
        });

        // æˆåˆ†ç¶²æ ¼ (é»æ“Šé–‹å•Ÿå°è¦–çª—)
        const chemGrid = document.getElementById('modal-chem-grid');
        chemGrid.innerHTML = "";
        if (item.components && item.components.length > 0) {
            item.components.forEach(c => {
                const div = document.createElement('div');
                div.className = 'chem-item';
                div.style.cursor = "pointer"; 
                
                // é»æ“Šå‘¼å« showChemDetail
                div.onclick = () => showChemDetail(c);

                const imgSrc = c.image || 'https://via.placeholder.com/150x100?text=No+Structure';
                div.innerHTML = `
                    <img src="${imgSrc}" alt="${c.name}">
                    <div class="chem-name">${c.name}</div>
                    ${c.note ? '<span style="font-size:0.8rem; color:#ff9800;">(æœ‰å‚™è¨»)</span>' : ''}
                `;
                chemGrid.appendChild(div);
            });
        } else {
            chemGrid.innerHTML = "<span style='color:#999'>ç„¡æˆåˆ†è³‡æ–™</span>";
        }

        // æ–‡å­—å€å¡Š
        document.getElementById('modal-char').innerText = item.characteristics || "æš«ç„¡";
        document.getElementById('modal-efficacy').innerText = item.efficacy || "æš«ç„¡";
        document.getElementById('modal-treat').innerText = item.treatment || "-";
        document.getElementById('modal-mnemonic').innerText = item.mnemonic || "-";

        // æ¯”è¼ƒè¡¨
        const compBody = document.getElementById('modal-compare-body');
        compBody.innerHTML = "";
        if (item.comparisons && item.comparisons.length > 0) {
            item.comparisons.forEach(cmp => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${cmp.target}</td><td>${cmp.diff}</td>`;
                compBody.appendChild(tr);
            });
            document.getElementById('compare-section').style.display = 'block';
        } else {
            document.getElementById('compare-section').style.display = 'none';
        }

        // ç­†è¨˜
        document.getElementById('modal-note').innerHTML = item.note || "<p style='color:#ccc'>ç„¡è©³ç´°ç­†è¨˜</p>";

        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeModalDirect() {
        document.getElementById('detail-modal').style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    function closeModal(event) {
        if (event.target.id === 'detail-modal') closeModalDirect();
    }

    // === 5. æˆåˆ†è©³æƒ…å°è¦–çª— (Popup) - ä¿®æ­£ç‰ˆ ===
    function showChemDetail(c) {
        // å¡«å…¥åå­—
        document.getElementById('chem-popup-name').innerText = c.name;
        
        // å¡«å…¥åœ–ç‰‡
        const img = document.getElementById('chem-popup-img');
        img.src = c.image || 'https://via.placeholder.com/300x200?text=No+Image';
        
        // å¡«å…¥å‚™è¨»
        const noteBox = document.getElementById('chem-popup-note-box');
        const noteContent = document.getElementById('chem-popup-note');

        if (c.note && c.note.trim() !== "") {
            // â˜… é—œéµä¿®æ”¹ï¼šé€™è£¡æ”¹æˆ innerHTMLï¼Œç€è¦½å™¨æ‰æœƒæŠŠ <ul> è®Šæˆåˆ—è¡¨ï¼Œè€Œä¸æ˜¯é¡¯ç¤ºæ–‡å­—
            noteContent.innerHTML = c.note; 
            noteBox.style.display = 'block';
        } else {
            noteBox.style.display = 'none';
        }

        // é¡¯ç¤ºå½ˆçª—
        document.getElementById('chem-detail-modal').style.display = 'flex';
    }

    function closeChemModal() {
        document.getElementById('chem-detail-modal').style.display = 'none';
    }

    // === 6. åˆ†é¡ä»‹ç´¹è¦–çª— (Intro Modal) ===
    function openCategoryModal() {
        const btn = document.getElementById('btn-cat-info');
        const realKey = btn.dataset.realKey;
        if (!realKey) return;
        
        document.getElementById('cat-modal-title').innerText = `${realKey} - è©³ç´°ä»‹ç´¹`;
        document.getElementById('cat-modal-body').innerHTML = categoryData[realKey] || "è¼‰å…¥å¤±æ•—";
        document.getElementById('cat-modal').style.display = 'flex';
    }

    function closeCategoryModal(e) {
        if (e.target.id === 'cat-modal') {
            document.getElementById('cat-modal').style.display = 'none';
        }
    }

    // è¼”åŠ©ï¼šæ›´æ–°æŒ‰éˆ•æ¨£å¼
    function updateActiveTag(el, className) {
        document.querySelectorAll('.' + className).forEach(e => e.classList.remove('active'));
        if(el) el.classList.add('active');
    }

</script>
</body>
</html>
