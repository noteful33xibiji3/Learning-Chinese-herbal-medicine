<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾Œå°ç®¡ç†å…¥å£ | æœ¬è‰å­¸åœ’</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
        }

        .container {
            width: 90%;
            max-width: 800px;
            text-align: center;
        }

        h1 { color: #2C5E4F; margin-bottom: 30px; font-size: 2rem; }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .menu-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            color: #333;
            border: 2px solid transparent;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            border-color: #4A7C59;
        }

        .icon { font-size: 3rem; display: block; margin-bottom: 15px; }
        .card-title { font-size: 1.5rem; font-weight: bold; color: #2C5E4F; display: block; margin-bottom: 10px; }
        .card-desc { color: #666; font-size: 0.95rem; line-height: 1.5; }

        /* ç™»å…¥è¦–çª— */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            z-index: 9999;
            display: flex; align-items: center; justify-content: center;
        }
        .login-box {
            background: white; padding: 40px; border-radius: 20px;
            width: 90%; max-width: 400px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        
        input {
            width: 100%; padding: 12px; margin: 10px 0;
            border: 1px solid #ccc; border-radius: 8px;
            box-sizing: border-box; font-size: 1rem;
        }
        
        .btn {
            background: #4A7C59; color: white; border: none;
            padding: 12px 25px; border-radius: 50px; font-size: 1rem;
            cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px;
        }
        .btn:hover { background: #3a6346; }
        
        #loading-msg { color: #666; margin-top: 10px; display: none; }
        .error-msg { color: #dc3545; margin-top: 10px; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div class="container" id="main-menu" style="display:none;">
        <h1>ğŸŒ¿ æœ¬è‰å­¸åœ’å¾Œå°ç®¡ç†</h1>
        <div class="menu-grid">
            <a href="admin.html" class="menu-card">
                <span class="icon">ğŸ’Š</span>
                <span class="card-title">ä¸­è—¥è³‡æ–™åº«</span>
                <span class="card-desc">ç®¡ç†å‚³çµ±ä¸­è—¥æè³‡æ–™ã€åœ–ç‰‡ã€åŸºåŸã€æ€§å‘³æ­¸ç¶“èˆ‡åŠŸæ•ˆã€‚</span>
            </a>

            <a href="admin_pharma.html" class="menu-card">
                <span class="icon">ğŸ”¬</span>
                <span class="card-title">ç”Ÿè—¥è³‡æ–™åº«</span>
                <span class="card-desc">ç®¡ç†è©³ç´°ç”Ÿè—¥åŒ–å­¸æˆåˆ†ã€åˆ†é¡ç°¡ä»‹ (é…é†£é«”/ç”Ÿç‰©é¹¼ç­‰) èˆ‡æ¯”è¼ƒè¡¨ã€‚</span>
            </a>
        </div>
        
        <button onclick="logout()" style="background:transparent; border:1px solid #999; color:#666; padding:8px 20px; border-radius:20px; margin-top:40px; cursor:pointer;">
            ç™»å‡ºç³»çµ±
        </button>
    </div>

    <div id="login-overlay">
        <div class="login-box">
            <h2 style="color:#2C5E4F; margin-top:0;">ğŸ” ç®¡ç†å“¡é©—è­‰</h2>
            <p style="color:#666; font-size:0.9rem; margin-bottom:20px;">è«‹è¼¸å…¥ GitHub è¨­å®šä»¥è§£é–å¾Œå°</p>
            
            <input type="text" id="gh-user" placeholder="GitHub å¸³è™Ÿ">
            <input type="text" id="gh-repo" placeholder="å€‰åº«åç¨± (Repository)">
            <input type="password" id="gh-token" placeholder="Token (ghp_...)">
            
            <button class="btn" onclick="performLogin()">ğŸš€ é€£ç·šä¸¦ç™»å…¥</button>
            <div id="loading-msg">â³ é€£ç·šé©—è­‰ä¸­...</div>
            <div id="login-msg" class="error-msg"></div>
        </div>
    </div>

    <script src="utils.js"></script>

    <script>
        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
        document.addEventListener('DOMContentLoaded', () => {
            const savedConfig = localStorage.getItem('tcm_admin_config');
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                // è‡ªå‹•å¡«å…¥æ¬„ä½ (æ–¹ä¾¿é‡æ–°ç™»å…¥)
                document.getElementById('gh-user').value = config.user;
                document.getElementById('gh-repo').value = config.repo;
                document.getElementById('gh-token').value = config.token;
                
                // å˜—è©¦è‡ªå‹•é©—è­‰
                verifyAndUnlock(config.token, config.user, config.repo);
            }
        });

        function performLogin() {
            const user = document.getElementById('gh-user').value.trim();
            const repo = document.getElementById('gh-repo').value.trim();
            const token = document.getElementById('gh-token').value.trim();

            if (!user || !repo || !token) {
                showError("è«‹å¡«å¯«å®Œæ•´è³‡è¨Š");
                return;
            }

            verifyAndUnlock(token, user, repo);
        }

        // ä½¿ç”¨ utils.js çš„åŠŸèƒ½ä¾†é©—è­‰
        function verifyAndUnlock(token, user, repo) {
            const loading = document.getElementById('loading-msg');
            const errorDiv = document.getElementById('login-msg');
            
            loading.style.display = 'block';
            errorDiv.innerText = "";

            // å‘¼å« utils.js è£¡çš„ initGitHubConfig
            initGitHubConfig(token, user, repo)
                .then(() => {
                    // é©—è­‰æˆåŠŸï¼šå­˜æª”ä¸¦åˆ‡æ›ç•«é¢
                    const config = { token, user, repo };
                    localStorage.setItem('tcm_admin_config', JSON.stringify(config));
                    
                    document.getElementById('login-overlay').style.display = 'none';
                    document.getElementById('main-menu').style.display = 'block';
                })
                .catch(err => {
                    showError(err.message);
                })
                .finally(() => {
                    loading.style.display = 'none';
                });
        }

        function showError(msg) {
            document.getElementById('login-msg').innerText = msg;
        }

        function logout() {
            if(confirm("ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ")) {
                localStorage.removeItem('tcm_admin_config');
                location.reload();
            }
        }
    </script>
</body>
</html>
