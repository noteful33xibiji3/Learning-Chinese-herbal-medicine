<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­è—¥æŸ¥è©¢ | æœ¬è‰å­¸åœ’</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav>
        <div class="nav-left">
            <button class="back-btn" onclick="history.back()">â®</button>
            <a href="index.html" class="logo">ğŸŒ¿ æœ¬è‰å­¸åœ’</a>
        </div>
        <div class="burger" onclick="toggleMenu()">â˜°</div>
        <ul class="menu" id="nav-menu">
            <li><a href="index.html" class="active">ä¸­è—¥æŸ¥è©¢</a></li>
            <li><a href="pharmacognosy.html">ç”Ÿè—¥åˆ†é¡</a></li>
            <li><a href="quiz.html">è‡ªæˆ‘æ¸¬é©—</a></li>
            <li><a href="mistakes.html">éŒ¯é¡Œè¤‡ç¿’</a></li>
        </ul>
    </nav>

    <main>
        <div class="hero">
            <h1>ä¸­è—¥è³‡æ–™åº«</h1>
            <p>è¼¸å…¥ä¸­è—¥åã€è‹±æ–‡åã€æˆåˆ†æˆ–ç§‘å</p>
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="search-input" 
                           placeholder="ä¾‹å¦‚ï¼šé»ƒé€£, Berberine..." 
                           autocomplete="off"
                           oninput="showSuggestions(this.value)"
                           onkeydown="if(event.key === 'Enter') triggerSearch()">
                    <button onclick="triggerSearch()">æœå°‹</button>
                </div>
                <div id="suggestions" class="suggestions-list"></div>
            </div>
        </div>

        <div id="herb-grid" class="herb-grid">
            </div>
    </main>

   <script>
    // 1. å®šç¾©å…¨åŸŸè®Šæ•¸
    let db = []; 
    const input = document.getElementById('searchInput');
    const suggestionsBox = document.getElementById('suggestions');
    const resultsArea = document.getElementById('results-area');

    // 2. ç¶²é è¼‰å…¥æ™‚ï¼ŒæŠ“å– GitHub è£¡çš„è³‡æ–™ (data/herbs.json)
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch('data/herbs.json'); // ç¢ºä¿è·¯å¾‘æ­£ç¢º
            if (!response.ok) throw new Error("è³‡æ–™è®€å–å¤±æ•—");
            db = await response.json();
            console.log("è³‡æ–™åº«è¼‰å…¥æˆåŠŸï¼Œå…± " + db.length + " ç­†è³‡æ–™");
        } catch (error) {
            console.error(error);
            resultsArea.innerHTML = `<p style="text-align:center; color:red;">âŒ è³‡æ–™åº«è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ data/herbs.json æ˜¯å¦å­˜åœ¨ã€‚</p>`;
        }
    });

    // 3. ç›£è½è¼¸å…¥äº‹ä»¶ï¼šç”¢ç”Ÿå»ºè­°è© (Google Style)
    input.addEventListener('input', function() {
        const val = this.value.toLowerCase().trim();
        suggestionsBox.innerHTML = '';
        
        if (!val || db.length === 0) {
            suggestionsBox.style.display = 'none';
            // å¦‚æœæ¸…ç©ºæœå°‹æ¡†ï¼ŒåŒæ™‚æ¸…ç©ºä¸‹æ–¹çµæœ
            if (!val) resultsArea.innerHTML = ''; 
            return;
        }

        // éæ¿¾é‚è¼¯ (æ¯”å° JSON è£¡çš„æ­£ç¢ºæ¬„ä½åç¨±)
        const matches = db.filter(item => {
            // é€™è£¡è¦ç”¨ä½  JSON è£¡çœŸæ­£çš„æ¬„ä½åç¨± (chinese_name, latin_name...)
            const origin = item.origin || ""; // é é˜² origin æ˜¯ç©ºçš„
            const chemistry = item.chemistry || "";
            
            return item.chinese_name.includes(val) || 
                   item.latin_name.toLowerCase().includes(val) ||
                   item.family.toLowerCase().includes(val) ||
                   origin.toLowerCase().includes(val) || // æœå°‹åŸºåŸ
                   chemistry.toLowerCase().includes(val); // æœå°‹æˆåˆ†
        }).slice(0, 8); // åªé¡¯ç¤ºå‰ 8 ç­†å»ºè­°ï¼Œé¿å…å¤ªé•·

        if (matches.length > 0) {
            suggestionsBox.style.display = 'block';
            matches.forEach(item => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                // å»ºè­°é¸å–®é¡¯ç¤ºï¼šä¸­æ–‡å (ç”Ÿè—¥å)
                div.innerHTML = `<span class="s-main">${item.chinese_name}</span><span class="s-sub">${item.latin_name}</span>`;
                
                // é»æ“Šå»ºè­°è©å¾Œçš„å‹•ä½œ
                div.onclick = function() {
                    input.value = item.chinese_name; // å¡«å…¥è¼¸å…¥æ¡†
                    suggestionsBox.style.display = 'none'; // éš±è—å»ºè­°
                    displayResult(item); // é¡¯ç¤ºè©³ç´°å¡ç‰‡
                };
                suggestionsBox.appendChild(div);
            });
        } else {
            suggestionsBox.style.display = 'none';
        }
    });

    // 4. é»æ“Šé é¢å…¶ä»–åœ°æ–¹æ™‚ï¼Œé—œé–‰å»ºè­°é¸å–®
    document.addEventListener('click', function(e) {
        if (e.target !== input && e.target !== suggestionsBox) {
            suggestionsBox.style.display = 'none';
        }
    });

    // 5. æ”¯æ´æŒ‰ Enter æœå°‹ (é¡¯ç¤ºæ‰€æœ‰ç¬¦åˆé …ç›®)
    input.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const val = this.value.toLowerCase().trim();
            suggestionsBox.style.display = 'none';
            
            // é‡æ–°éæ¿¾ä¸€æ¬¡ï¼Œé€™æ¬¡ä¸é™åˆ¶æ•¸é‡
            const matches = db.filter(item => {
                const origin = item.origin || "";
                const chemistry = item.chemistry || "";
                return item.chinese_name.includes(val) || 
                       item.latin_name.toLowerCase().includes(val) ||
                       item.family.toLowerCase().includes(val) ||
                       origin.toLowerCase().includes(val) ||
                       chemistry.toLowerCase().includes(val);
            });
            
            resultsArea.innerHTML = "";
            if(matches.length === 0) {
                resultsArea.innerHTML = "<p style='text-align:center; color:#666; margin-top:20px;'>æ‰¾ä¸åˆ°ç¬¦åˆçš„è—¥æ...</p>";
            } else {
                matches.forEach(item => displayResult(item, true)); // true ä»£è¡¨æ˜¯åˆ—è¡¨æ¨¡å¼(å¤šå¼µå¡ç‰‡)
            }
        }
    });

    // 6. é¡¯ç¤ºè©³ç´°è³‡æ–™å¡ç‰‡ (é€™è£¡è¦å°æ‡‰ä½  JSON çš„æ¬„ä½)
    function displayResult(item, append = false) {
        if (!append) resultsArea.innerHTML = ""; // å¦‚æœä¸æ˜¯åˆ—è¡¨æ¨¡å¼ï¼Œå…ˆæ¸…ç©ºèˆŠçš„

        // è™•ç†ç©ºå€¼é¡¯ç¤º
        const originText = item.origin ? item.origin : "æš«ç„¡è³‡æ–™";
        const chemText = item.chemistry ? item.chemistry : "æš«ç„¡è³‡æ–™";
        const noteText = item.indications ? item.indications : "";

        const div = document.createElement("div");
        div.className = "result-card";
        div.innerHTML = `
            <div class="r-header">
                <span class="r-name">${item.chinese_name}</span>
                <span class="r-family">${item.family}</span>
            </div>
            <div class="r-detail-row"><span class="label">ç”Ÿè—¥å:</span> ${item.latin_name}</div>
            <div class="r-detail-row"><span class="label">åŸºåŸ:</span> ${originText}</div>
            <div class="r-detail-row"><span class="label">æˆåˆ†:</span> ${chemText}</div>
            <div class="r-detail-row"><span class="label">åŠŸæ•ˆ:</span> ${item.effects.join('ã€')}</div>
            <div class="r-detail-row"><span class="label">å‚™è¨»:</span> ${noteText}</div>
        `;
        resultsArea.appendChild(div);
    }
</script>
</body>
</html>
