<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自我測驗 | 本草學園</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav>
        <div class="nav-left">
            <button class="back-btn" onclick="history.back()">❮</button>
            <a href="index.html" class="logo">🌿 本草學園</a>
        </div>
        <div class="burger" onclick="toggleMenu()">☰</div>
        <ul class="menu" id="nav-menu">
            <li><a href="index.html">中藥查詢</a></li>
            <li><a href="pharmacognosy.html">生藥分類</a></li>
            <li><a href="quiz.html" class="active">自我測驗</a></li>
            <li><a href="mistakes.html">錯題複習</a></li>
        </ul>
    </nav>

    <main>
        <div id="setup-panel">
            <h2>🛠️ 測驗設定</h2>
            
            <div class="setup-group">
                <h3>1. 快速選擇範圍 (批次勾選)</h3>
                <p style="font-size:0.9rem; color:#666; margin-bottom:10px;">勾選年級會自動選取下方對應的中藥：</p>
                <div id="grade-checkboxes" class="checkbox-grid"></div>
            </div>

            <div class="setup-group">
                <h3>2. 預覽 / 微調測驗中藥</h3>
                
                <div style="background:#f1f3f4; padding:10px; border-radius:8px; margin-bottom:10px;">
                    <input type="text" id="filter-search" placeholder="在此搜尋要考的中藥..." 
                           style="width:100%; margin-bottom:10px; padding:10px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box;">
                    
                    <div style="display:flex; gap:10px; justify-content: space-between; align-items:center;">
                        <span id="selected-count" style="font-size:0.9rem; color:var(--primary); font-weight:bold;">已選: 0</span>
                        <div>
                            <button class="btn-sm" onclick="selectAllHerbs(true)">全選顯示項目</button>
                            <button class="btn-sm" onclick="selectAllHerbs(false)">清空顯示項目</button>
                        </div>
                    </div>
                </div>

                <div id="manual-selection-list" class="checkbox-grid" 
                     style="grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); max-height:400px; overflow-y:auto; border:1px solid #eee; padding:10px;">
                    </div>
            </div>

            <div class="setup-group">
                <h3>3. 測驗項目 (可複選)</h3>
                <div class="checkbox-grid">
                    <label class="checkbox-label"><input type="checkbox" name="quizMode" value="effects" checked> 功效</label>
                    <label class="checkbox-label"><input type="checkbox" name="quizMode" value="family"> 科名</label>
                    <label class="checkbox-label"><input type="checkbox" name="quizMode" value="latin_name"> 生藥名</label>
                    <label class="checkbox-label"><input type="checkbox" name="quizMode" value="origin"> 基原(學名)</label>
                    <label class="checkbox-label"><input type="checkbox" name="quizMode" value="used_part"> 用部</label>
                    <label class="checkbox-label"><input type="checkbox" name="quizMode" value="chemistry"> 成分</label>
                </div>
            </div>

            <button class="btn-primary" onclick="initCustomQuiz()">開始測驗</button>
        </div>

        <div id="quiz-panel" style="display: none;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <span id="progress-display" style="font-weight:bold; color:#666;"></span>
                <span id="score-display" style="font-weight:bold; color:var(--primary);"></span>
            </div>
            
            <div id="quiz-card" class="herb-card" style="padding:25px; text-align:center;"></div>
            
            <div class="quiz-nav-buttons">
                <button id="prev-btn" class="nav-btn" onclick="prevQuestion()">⬅ 上一題</button>
                <button id="next-btn" class="nav-btn next" onclick="nextQuestion()">下一題 ➡</button>
            </div>

            <button class="btn-primary" onclick="showResult()" style="background:#666; margin-top:30px; padding:10px 20px; font-size:0.9rem;">結束測驗並結算</button>
        </div>

        <div id="result-panel" style="display: none;">
            <h2>📊 測驗結果</h2>
            <h1 id="final-score" style="color:var(--primary); font-size:3rem; margin:20px 0;"></h1>
            <p id="result-msg"></p>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn-primary" onclick="resetQuizSetup()">重新設定</button>
                <button id="retry-mistakes-btn" class="btn-primary" style="background:#dc3545; display:none;" onclick="retryMistakes()">錯誤題重測</button>
            </div>
        </div>
    </main>

    <script src="app.js"></script>
    
    <style>
        .btn-sm { padding: 5px 10px; border: 1px solid #ddd; background: white; border-radius: 5px; cursor: pointer; font-size: 0.85rem; }
        .btn-sm:hover { background: #eee; }
    </style>
</body>
</html>
