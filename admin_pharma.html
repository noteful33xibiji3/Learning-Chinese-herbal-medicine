<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿè—¥è³‡æ–™åº«ç®¡ç† | æœ¬è‰å­¸åœ’</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.2/tinymce.min.js" referrerpolicy="origin"></script>
    
    <style>
        /* === æ¨£å¼å€ (èˆ‡ admin_menu é¢¨æ ¼çµ±ä¸€) === */
        body { background: #f0f2f5; font-family: 'Noto Sans TC', sans-serif; margin: 0; padding: 0; }
        
        /* å°è¦½åˆ— */
        nav { background: white; padding: 15px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .nav-title { font-size: 1.2rem; font-weight: bold; color: #2C5E4F; text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .back-btn { background: #e0e0e0; color: #333; padding: 5px 12px; border-radius: 20px; text-decoration: none; font-size: 0.9rem; }

        /* ä¸»å®¹å™¨ */
        main { max-width: 1200px; margin: 20px auto; padding: 0 15px; }
        
        /* åˆ—è¡¨å€ */
        .card-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 20px; }
        .pharma-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); cursor: pointer; transition: 0.2s; border-left: 5px solid #4A7C59; }
        .pharma-card:hover { transform: translateY(-3px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .card-name { font-size: 1.3rem; font-weight: bold; color: #333; margin: 0; }
        .card-cat { background: #e8f5e9; color: #2C5E4F; padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; }
        .card-en { color: #666; font-size: 0.9rem; font-style: italic; }

        /* ç·¨è¼¯è¦–çª— (Modal) */
        #edit-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; overflow-y: auto; padding: 20px 0; }
        .modal-content { background: white; width: 95%; max-width: 900px; margin: 0 auto 50px auto; padding: 30px; border-radius: 15px; position: relative; }
        
        /* è¡¨å–®å…ƒä»¶ */
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #444; }
        input[type="text"], select, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        
        /* åˆ†å€æ¨™é¡Œ */
        .section-title { font-size: 1.1rem; color: #2C5E4F; border-bottom: 2px solid #eee; padding-bottom: 5px; margin: 30px 0 15px 0; font-weight: bold; }

        /* å‹•æ…‹åˆ—è¡¨ (åˆ¥åã€æ¯”è¼ƒç­‰) */
        .dynamic-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; background: #fafafa; padding: 10px; border-radius: 8px; border: 1px solid #eee; }
        .dynamic-row input { margin: 0; }
        
        /* æŒ‰éˆ• */
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; }
        .btn-primary { background: #4A7C59; }
        .btn-add { background: #607d8b; width: 100%; margin-top: 5px; }
        .btn-danger { background: #e57373; padding: 5px 10px; }
        
        /* è¼‰å…¥é®ç½© */
        #loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:2000; display:flex; justify-content:center; align-items:center; flex-direction:column; }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div style="font-size:2rem;">â³</div>
        <p id="loading-text">æ­£åœ¨é€£æ¥ GitHub è³‡æ–™åº«...</p>
    </div>

  <nav>
        <div class="nav-title">
            <a href="admin_menu.html" class="back-btn">â¬… å›é¸å–®</a>
            <a href="pharmacognosy.html" class="back-btn" style="background:#e8f5e9; color:#2C5E4F; margin-left:5px;">ğŸ  å»å‰å°çœ‹</a>
            <span style="margin-left:10px;">ğŸ”¬ ç”Ÿè—¥è³‡æ–™åº«ç®¡ç†</span>
        </div>
        <button onclick="openModal()" class="btn btn-primary">ï¼‹ æ–°å¢ç”Ÿè—¥</button>
    </nav>

    <main>
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <input type="text" id="search-input" placeholder="ğŸ” æœå°‹ç”Ÿè—¥åç¨±ã€å­¸åã€æˆåˆ†..." oninput="renderList()">
            <select id="filter-cat" onchange="renderList()" style="width:150px;">
                <option value="">æ‰€æœ‰åˆ†é¡</option>
            </select>
        </div>

        <div id="pharma-list" class="card-container"></div>
    </main>

    <div id="edit-modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="margin:0; color:#2C5E4F;">ç·¨è¼¯ç”Ÿè—¥è³‡æ–™</h2>
                <button onclick="closeModal()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">âœ•</button>
            </div>
            
            <input type="hidden" id="edit-id">

            <div class="form-group" style="background:#e8f5e9; padding:15px; border-radius:10px;">
                <label>ğŸ“Œ ç”Ÿè—¥åˆ†é¡ (ä¾æ“š Word è¨­å®š)</label>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <select id="cat-main" onchange="updateSubCats()"><option value="">- å¤§åˆ†é¡ -</option></select>
                    <select id="cat-sub"><option value="">- ä¸­åˆ†é¡ -</option></select>
                </div>
            </div>

            <div class="section-title">åŸºæœ¬è³‡æ–™</div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <div><label>ç”Ÿè—¥åç¨± (ä¸­æ–‡)</label><input type="text" id="name-ch" placeholder="ä¾‹å¦‚ï¼šéº»é»ƒ"></div>
                <div><label>ç”Ÿè—¥åç¨± (è‹±æ–‡)</label><input type="text" id="name-en" placeholder="ä¾‹å¦‚ï¼šEphedra"></div>
            </div>
            
            <label style="margin-top:10px;">åˆ¥å (Alias)</label>
            <div id="alias-list"></div>
            <button class="btn btn-add" onclick="addAliasRow()">+ æ–°å¢åˆ¥å</button>

            <div class="section-title">åŸºåŸèˆ‡ç§‘åˆ¥</div>
            <div class="form-group">
                <label>åŸºåŸ (Origin)</label>
                <input type="text" id="origin" placeholder="ä¾‹å¦‚ï¼šEphedra sinica Stapf">
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <div><label>ç§‘å (ä¸­æ–‡)</label><input type="text" id="family-ch" placeholder="éº»é»ƒç§‘"></div>
                <div><label>ç§‘å (è‹±æ–‡)</label><input type="text" id="family-en" placeholder="Ephedraceae"></div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-top:10px;">
                <div><label>ä½¿ç”¨éƒ¨ä½ (ä¸­æ–‡)</label><input type="text" id="part-ch" placeholder="ä¹¾ç‡¥è‰è³ªè–"></div>
                <div><label>ä½¿ç”¨éƒ¨ä½ (è‹±æ–‡)</label><input type="text" id="part-en" placeholder="Stem"></div>
            </div>

            <div class="section-title">âš—ï¸ åŒ–å­¸æˆåˆ† (Components)</div>
            <div id="chem-list"></div>
            <button class="btn btn-add" style="background:#4A7C59;" onclick="addChemRow()">+ æ–°å¢æˆåˆ†èˆ‡çµæ§‹åœ–</button>

            <div class="section-title">âš–ï¸ æ¯”è¼ƒ (Comparison)</div>
            <p style="font-size:0.85rem; color:#666;">é©åˆè¼¸å…¥æ˜“æ··æ·†è—¥æçš„æ¯”è¼ƒ</p>
            <div id="compare-list"></div>
            <button class="btn btn-add" onclick="addCompareRow()">+ æ–°å¢æ¯”è¼ƒé …ç›®</button>

            <div class="section-title">ç‰¹æ€§èˆ‡åŠŸæ•ˆ</div>
            <div class="form-group"><label>æ€§ç‹€/ç‰¹æ€§</label><textarea id="characteristics" rows="3"></textarea></div>
            <div class="form-group"><label>åŠŸæ•ˆ (Efficacy)</label><textarea id="efficacy" rows="3"></textarea></div>
            <div class="form-group"><label>é©æ‡‰ç—‡/æ²»ç™‚ (Treatment)</label><textarea id="treatment" rows="2"></textarea></div>
            <div class="form-group"><label>è¨˜æ³• (Mnemonic)</label><input type="text" id="mnemonic" placeholder="å£è¨£..."></div>

            <div class="section-title">ğŸ“ è©³ç´°å‚™è¨» (æ”¯æ´è¡¨æ ¼ã€åŠ ç²—)</div>
            <textarea id="rich-note"></textarea>

            <div style="margin-top:30px; display:flex; gap:10px;">
                <button onclick="saveData()" class="btn btn-primary" style="flex:1; padding:15px; font-size:1.1rem;">ğŸ’¾ å„²å­˜è³‡æ–™</button>
            </div>
        </div>
    </div>

    <script src="pharma_config.js"></script>
    <script src="utils.js"></script>

    <script>
        // === å…¨åŸŸè®Šæ•¸ ===
        let pharmaData = []; // å­˜æ”¾æ‰€æœ‰ç”Ÿè—¥è³‡æ–™
        let fileSha = "";    // GitHub æª”æ¡ˆæ ¡é©—ç¢¼
        const FILE_PATH = "data/pharma.json"; // å­˜æª”è·¯å¾‘

        // === åˆå§‹åŒ– ===
        document.addEventListener('DOMContentLoaded', async () => {
            // 1. åˆå§‹åŒ– TinyMCE ç·¨è¼¯å™¨
            tinymce.init({
                selector: '#rich-note',
                height: 300,
                menubar: false,
                plugins: 'table lists link',
                toolbar: 'undo redo | blocks | bold italic | alignleft aligncenter | bullist numlist | table'
            });

            // 2. æª¢æŸ¥ç™»å…¥ç‹€æ…‹
            const configStr = localStorage.getItem('tcm_admin_config');
            if (!configStr) {
                alert("è«‹å…ˆç™»å…¥ï¼");
                window.location.href = "admin_menu.html";
                return;
            }
            const config = JSON.parse(configStr);

            // 3. é€£ç·šä¸¦è®€å–è³‡æ–™
            try {
                await initGitHubConfig(config.token, config.user, config.repo);
                
                // å˜—è©¦è®€å– pharma.json
                try {
                    const result = await fetchJSON(FILE_PATH);
                    pharmaData = result.data;
                    fileSha = result.sha;
                } catch (e) {
                    console.log("å°šæœªæœ‰ pharma.jsonï¼Œå°‡å»ºç«‹æ–°æª”");
                    pharmaData = [];
                }

                initCatSelects();
                renderList();
                document.getElementById('loading-overlay').style.display = 'none';

            } catch (e) {
                alert("ç³»çµ±éŒ¯èª¤: " + e.message);
                document.getElementById('loading-text').innerText = "é€£ç·šå¤±æ•—ï¼Œè«‹å›é¦–é é‡è©¦";
            }
        });

        // === 1. åˆ†é¡é€£å‹•é‚è¼¯ ===
        function initCatSelects() {
            const mainSel = document.getElementById('cat-main');
            const filterSel = document.getElementById('filter-cat');
            
            // è®€å– PHARMA_CATEGORIES (ä¾†è‡ª pharma_config.js)
            PHARMA_CATEGORIES.forEach(cat => {
                const opt = new Option(`${cat.name_ch} (${cat.name_en})`, cat.name_ch);
                mainSel.add(opt);
                filterSel.add(opt.cloneNode(true));
            });
        }

        function updateSubCats() {
            const mainVal = document.getElementById('cat-main').value;
            const subSel = document.getElementById('cat-sub');
            subSel.innerHTML = '<option value="">- ä¸­åˆ†é¡ -</option>';
            
            const catData = PHARMA_CATEGORIES.find(c => c.name_ch === mainVal);
            if (catData) {
                catData.subcategories.forEach(sub => {
                    subSel.add(new Option(`${sub.ch} (${sub.en})`, sub.ch));
                });
            }
        }

        // === 2. åˆ—è¡¨æ¸²æŸ“ ===
        function renderList() {
            const container = document.getElementById('pharma-list');
            const search = document.getElementById('search-input').value.toLowerCase();
            const filter = document.getElementById('filter-cat').value;
            
            container.innerHTML = "";

            const filtered = pharmaData.filter(item => {
                const matchSearch = (item.name_ch || "").includes(search) || (item.name_en || "").toLowerCase().includes(search);
                const matchCat = filter ? item.category_main === filter : true;
                return matchSearch && matchCat;
            });

            filtered.forEach(item => {
                const div = document.createElement('div');
                div.className = 'pharma-card';
                div.onclick = () => openModal(item.id);
                div.innerHTML = `
                    <div class="card-header">
                        <span class="card-name">${item.name_ch}</span>
                        <span class="card-cat">${item.category_sub || item.category_main}</span>
                    </div>
                    <div class="card-en">${item.name_en}</div>
                    <div style="font-size:0.85rem; color:#888; margin-top:5px;">
                        ${item.family_ch || ""} / ${item.part_ch || ""}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // === 3. ç·¨è¼¯è¦–çª—é‚è¼¯ ===
        function openModal(id = null) {
            document.getElementById('edit-modal').style.display = 'block';
            document.getElementById('edit-id').value = id || "";
            
            // æ¸…ç©ºå‹•æ…‹å€å¡Š
            document.getElementById('alias-list').innerHTML = "";
            document.getElementById('chem-list').innerHTML = "";
            document.getElementById('compare-list').innerHTML = "";
            
            let data = {};
            if (id) {
                data = pharmaData.find(i => i.id === id) || {};
            }

            // å¡«å…¥æ¬„ä½
            document.getElementById('cat-main').value = data.category_main || "";
            updateSubCats();
            document.getElementById('cat-sub').value = data.category_sub || "";
            
            document.getElementById('name-ch').value = data.name_ch || "";
            document.getElementById('name-en').value = data.name_en || "";
            
            document.getElementById('origin').value = data.origin || "";
            document.getElementById('family-ch').value = data.family_ch || "";
            document.getElementById('family-en').value = data.family_en || "";
            document.getElementById('part-ch').value = data.part_ch || "";
            document.getElementById('part-en').value = data.part_en || "";
            
            document.getElementById('characteristics').value = data.characteristics || "";
            document.getElementById('efficacy').value = data.efficacy || "";
            document.getElementById('treatment').value = data.treatment || "";
            document.getElementById('mnemonic').value = data.mnemonic || "";

            // å¡«å……å¯Œæ–‡æœ¬ (TinyMCE)
            tinymce.get('rich-note').setContent(data.note || "");

            // å¡«å……åˆ—è¡¨
            (data.aliases || []).forEach(v => addAliasRow(v));
            (data.components || []).forEach(v => addChemRow(v));
            (data.comparisons || []).forEach(v => addCompareRow(v));

            if (!id) {
                // æ–°å¢æ¨¡å¼é è¨­çµ¦ç©ºè¡Œ
                addChemRow();
            }
        }

        function closeModal() {
            if(confirm("ç¢ºå®šé—œé–‰ï¼Ÿæœªå„²å­˜çš„è®Šæ›´å°‡æ¶ˆå¤±")) {
                document.getElementById('edit-modal').style.display = 'none';
            }
        }

        // === 4. å‹•æ…‹æ¬„ä½é‚è¼¯ ===
        // åˆ¥å
        function addAliasRow(val = "") {
            const div = document.createElement('div'); div.className = 'dynamic-row';
            div.innerHTML = `<input type="text" class="alias-input" value="${val}" placeholder="åˆ¥å"><button class="btn btn-danger" onclick="this.parentElement.remove()">âœ•</button>`;
            document.getElementById('alias-list').appendChild(div);
        }

        // æ¯”è¼ƒè¡¨ (å°è±¡ - å·®ç•°)
        function addCompareRow(data = {}) {
            const div = document.createElement('div'); div.className = 'dynamic-row';
            div.innerHTML = `
                <input type="text" class="comp-target" value="${data.target||''}" placeholder="æ¯”è¼ƒå°è±¡ (å¦‚: å½å“)" style="width:40%">
                <input type="text" class="comp-diff" value="${data.diff||''}" placeholder="å·®ç•°é»" style="width:60%">
                <button class="btn btn-danger" onclick="this.parentElement.remove()">âœ•</button>
            `;
            document.getElementById('compare-list').appendChild(div);
        }

        // === ä¿®æ”¹ç‰ˆï¼šæ–°å¢æˆåˆ† (å«å‚™è¨»æ¬„) ===
function addChemRow(data = {}) {
    const div = document.createElement('div'); 
    div.className = 'dynamic-row';
    div.style.flexDirection = 'column';
    div.style.alignItems = 'stretch';
    
    const imgId = `chem-img-${Date.now()}-${Math.random()}`;
    const imgVal = data.image || "";
    // â˜… æ–°å¢ï¼šè®€å–å‚™è¨»è³‡æ–™
    const noteVal = data.note || "";

    div.innerHTML = `
        <div style="display:flex; gap:5px; align-items:center;">
            <input type="text" class="chem-name" value="${data.name||''}" placeholder="æˆåˆ†åç¨± (å¦‚: Ephedrine)" style="flex:1;">
            <input type="text" class="chem-note" value="${noteVal}" placeholder="å‚™è¨» (å¦‚: å…·æ¯’æ€§)" style="flex:1;">
            <button class="btn btn-danger" onclick="this.closest('.dynamic-row').remove()">âœ•</button>
        </div>
        
        <div style="display:flex; align-items:center; gap:10px; margin-top:5px;">
            <label style="background:#eee; padding:5px 10px; border-radius:5px; cursor:pointer; font-size:0.9rem;">
                ğŸ“¸ ä¸Šå‚³çµæ§‹
                <input type="file" style="display:none" onchange="handleChemUpload(this, '${imgId}')">
            </label>
            <span class="chem-status" style="font-size:0.8rem; color:#666;">${imgVal ? 'å·²å­˜åœ–ç‰‡' : 'ç„¡åœ–ç‰‡'}</span>
        </div>
        <img id="${imgId}" src="${imgVal}" style="display:${imgVal?'block':'none'}; max-height:80px; margin-top:5px; border:1px solid #ccc;">
        <input type="hidden" class="chem-img-url" value="${imgVal}">
        <input type="hidden" class="chem-new-base64">
    `;
    document.getElementById('chem-list').appendChild(div);
}
        // è™•ç†æˆåˆ†åœ–ç‰‡ (é è¦½)
        function handleChemUpload(input, viewId) {
            const file = input.files[0];
            if(!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById(viewId).src = e.target.result;
                document.getElementById(viewId).style.display = 'block';
                // æ¨™è¨˜æœ‰æ–°åœ–ç‰‡
                const row = input.closest('.dynamic-row');
                row.querySelector('.chem-new-base64').value = 'PENDING'; // æ¨™è¨˜å¾…ä¸Šå‚³
                row.querySelector('.chem-status').innerText = 'æº–å‚™ä¸Šå‚³...';
                // å°‡æª”æ¡ˆç‰©ä»¶æš«å­˜åœ¨ input å…ƒç´ ä¸Šï¼Œæ–¹ä¾¿ä¸Šå‚³å‡½å¼è®€å–
                input.fileObj = file; 
            };
            reader.readAsDataURL(file);
        }

        // === 5. å„²å­˜é‚è¼¯ (æ ¸å¿ƒ) ===
async function saveData() {
    const idVal = document.getElementById('edit-id').value;
    const btn = document.querySelector('.btn-primary');
    btn.innerText = "â³ è™•ç†åœ–ç‰‡èˆ‡å­˜æª”ä¸­...";
    btn.disabled = true;

    try {
        // A. è™•ç†åœ–ç‰‡ä¸Šå‚³èˆ‡æˆåˆ†æ”¶é›†
        const chemRows = document.querySelectorAll('#chem-list .dynamic-row');
        const components = [];

        for (let row of chemRows) {
            const name = row.querySelector('.chem-name').value.trim();
            // â˜… æ–°å¢ï¼šæŠ“å–å‚™è¨»
            const note = row.querySelector('.chem-note').value.trim();
            
            if (!name) continue;

            let imgUrl = row.querySelector('.chem-img-url').value;
            const fileInput = row.querySelector('input[type="file"]');
            
            if (fileInput.fileObj) {
                imgUrl = await compressAndUploadImage(fileInput.fileObj, 'images/pharma');
            }

            // â˜… å°‡ note åŠ å…¥å­˜æª”ç‰©ä»¶
            components.push({ name: name, image: imgUrl, note: note });
        }

                // B. æ”¶é›†ä¸€èˆ¬è³‡æ–™
                const aliases = Array.from(document.querySelectorAll('.alias-input')).map(i => i.value.trim()).filter(v => v);
                const comparisons = Array.from(document.querySelectorAll('#compare-list .dynamic-row')).map(row => ({
                    target: row.querySelector('.comp-target').value.trim(),
                    diff: row.querySelector('.comp-diff').value.trim()
                })).filter(c => c.target);

                // C. å»ºç«‹è³‡æ–™ç‰©ä»¶
                const newItem = {
                    id: idVal ? parseInt(idVal) : Date.now(),
                    category_main: document.getElementById('cat-main').value,
                    category_sub: document.getElementById('cat-sub').value,
                    name_ch: document.getElementById('name-ch').value.trim(),
                    name_en: document.getElementById('name-en').value.trim(),
                    aliases: aliases,
                    origin: document.getElementById('origin').value.trim(),
                    family_ch: document.getElementById('family-ch').value.trim(),
                    family_en: document.getElementById('family-en').value.trim(),
                    part_ch: document.getElementById('part-ch').value.trim(),
                    part_en: document.getElementById('part-en').value.trim(),
                    components: components,
                    comparisons: comparisons,
                    characteristics: document.getElementById('characteristics').value,
                    efficacy: document.getElementById('efficacy').value,
                    treatment: document.getElementById('treatment').value,
                    mnemonic: document.getElementById('mnemonic').value,
                    // å–å¾— TinyMCE çš„ HTML å…§å®¹
                    note: tinymce.get('rich-note').getContent(),
                    updated_at: new Date().toISOString()
                };

                // D. æ›´æ–°æœ¬åœ°é™£åˆ—
                if (idVal) {
                    const idx = pharmaData.findIndex(i => i.id == idVal);
                    if (idx !== -1) pharmaData[idx] = newItem;
                } else {
                    pharmaData.push(newItem);
                }

                // E. ä¸Šå‚³ JSON åˆ° GitHub
                const res = await saveJSON(FILE_PATH, pharmaData, fileSha, `Update Pharma: ${newItem.name_ch}`);
                fileSha = res.content.sha; // æ›´æ–° SHA é¿å…è¡çª

                alert("ğŸ‰ å„²å­˜æˆåŠŸï¼");
                document.getElementById('edit-modal').style.display = 'none';
                renderList();

            } catch (e) {
                alert("éŒ¯èª¤: " + e.message);
                console.error(e);
            } finally {
                btn.innerText = "ğŸ’¾ å„²å­˜è³‡æ–™";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
